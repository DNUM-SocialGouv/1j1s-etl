"use strict";var c=class{static create(e){return{ImportDeclaration(t){c.checkNoCrossContext(e,t)}}}static checkNoCrossContext(e,t){let r=this.getCurrentImportModuleName(t.source.value,this.modules);if(this.isWithinApplicationImport(r)){let o={importModuleName:r,fileModuleName:this.extractCurrentFileModuleName(e.getPhysicalFilename()),isImportFromContextModules:this.contextModules.includes(r),isImportFromTechnicalModules:this.technicalModules.includes(r)},i=!1;switch(o.fileModuleName){case"@shared":i=this.shallAllowImportForSharedModule(o);break;case"@evenements":case"@logements":case"@stages":i=this.shallAllowImportForDomainModule(o);break;case"@configuration":i=this.shallAllowImportForConfigurationModule(o);break;default:break}i&&e.report({node:t,message:"Forbidden cross-context import"})}}static extractCurrentFileModuleName(e){let r=new RegExp(/src\/[a-zA-Z]*\//).exec(e),o="";return r!==null&&r.length>0&&(o="@".concat(r[0].split("/")[1])),o}static isWithinApplicationImport(e){return this.modules.includes(e)}static getCurrentImportModuleName(e,t){for(let r of t)if(e.match(r))return r;return""}static shallAllowImportForSharedModule(e){return e.isImportFromContextModules||e.isImportFromTechnicalModules}static shallAllowImportForDomainModule(e){return this.isDifferentDomainModule(e)||this.isUnallowedTechnicalModule(e)}static shallAllowImportForConfigurationModule(e){return e.isImportFromTechnicalModules&&e.importModuleName!==e.fileModuleName||e.isImportFromContextModules}static isDifferentDomainModule(e){return e.isImportFromContextModules&&e.importModuleName!==e.fileModuleName}static isUnallowedTechnicalModule(e){return e.isImportFromTechnicalModules&&e.importModuleName!=="@configuration"}},a=c;a.contextModules=["@evenements","@logements","@stages"],a.technicalModules=["@cli","@configuration","@test"],a.modules=[...c.contextModules,...c.technicalModules];var u=class{static create(e){return{ImportDeclaration:t=>{u.checkNoCrossSubContext(e,t)}}}static checkNoCrossSubContext(e,t){let r=this.getSubcontext(e.getPhysicalFilename()),o=this.getSubcontext(t.source.value);this.importIsFromAnotherContextThanFileOne(r,o)&&e.report({node:t,message:this.message})}static getSubcontext(e){for(let t of this.subcontexts)if(e.match(t))return t;return""}static importIsFromAnotherContextThanFileOne(e,t){return this.subcontexts.includes(e)&&this.subcontexts.includes(t)&&t!==e}},n=u;n.subcontexts=["extraction","transformation","chargement"],n.message="Forbidden cross-subcontext import";var l=class{static create(e){return{ImportDeclaration:t=>{l.checkNoTechnicalImportIntoDomain(e,t)}}}static checkNoTechnicalImportIntoDomain(e,t){let r=e.getPhysicalFilename();if(r.match("test")||r.match("task")||r.match("container"))return;let o=this.getDirectory(r),i=this.getDirectory(t.source.value);switch(o){case"domain":(this.technicalDirectories.includes(i)||i==="usecase")&&e.report({node:t,message:this.message});break;case"usecase":this.technicalDirectories.includes(i)&&e.report({node:t,message:this.message});break;case"infrastructure":i==="usecase"&&e.report({node:t,message:this.message});break;default:break}}static getDirectory(e){for(let t of this.directoriesToCheck)if(e.match(t))return t;return""}},s=l;s.domainAndBoundariesDirectories=["domain","usecase"],s.technicalDirectories=["configuration","infrastructure"],s.directoriesToCheck=[...l.domainAndBoundariesDirectories,...l.technicalDirectories],s.message="Onion architecture violation";module.exports={rules:{"no-cross-context-import":{create:a.create,meta:{docs:{description:"Avoid cross-context import which can lead to strong coupling across the application",recommended:"error"},type:"problem"}},"no-cross-subcontext-import":{create:n.create,meta:{docs:{description:"Avoid cross-subcontext import which can lead to strong coupling across the application",recommended:"error"},type:"problem"}},"no-onion-architecture-violation":{create:s.create,meta:{docs:{description:"Enforces software design rules based on Onion architecture",recommended:"error"},type:"problem"}}},configs:{architecture:{plugins:["@1j1s"],rules:{"@1j1s/no-cross-context-import":"error","@1j1s/no-cross-subcontext-import":"error","@1j1s/no-onion-architecture-violation":"error"}}}};
