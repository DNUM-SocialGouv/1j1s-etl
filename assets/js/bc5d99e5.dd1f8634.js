"use strict";(self.webpackChunk_1j1s_etl_docs=self.webpackChunk_1j1s_etl_docs||[]).push([[634],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>v});var r=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=r.createContext({}),u=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},c=function(e){var n=u(e.components);return r.createElement(s.Provider,{value:n},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=u(t),m=i,v=p["".concat(s,".").concat(m)]||p[m]||d[m]||o;return t?r.createElement(v,a(a({ref:n},c),{},{components:t})):r.createElement(v,a({ref:n},c))}));function v(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var o=t.length,a=new Array(o);a[0]=m;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[p]="string"==typeof e?e:i,a[1]=l;for(var u=2;u<o;u++)a[u]=t[u];return r.createElement.apply(null,a)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},1890:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>u});var r=t(7462),i=(t(7294),t(3905));const o={},a="Mise en Production",l={unversionedId:"adr/2022-11-07.mise-en-production",id:"adr/2022-11-07.mise-en-production",title:"Mise en Production",description:"7 novembre 2022",source:"@site/docs/adr/2022-11-07.mise-en-production.md",sourceDirName:"adr",slug:"/adr/2022-11-07.mise-en-production",permalink:"/1j1s-etl/docs/adr/2022-11-07.mise-en-production",draft:!1,editUrl:"https://github.com/DNUM-SocialGouv/1j1s-etl/tree/main/docs/docs/docs/adr/2022-11-07.mise-en-production.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Utilisation des Scheduled Tasks",permalink:"/1j1s-etl/docs/adr/2022-08-03.scheduled-tasks"},next:{title:"Onion Architecture",permalink:"/1j1s-etl/docs/adr/2023-01-28.onion-architecture"}},s={},u=[{value:"Contributeurs",id:"contributeurs",level:2},{value:"Statut",id:"statut",level:2},{value:"Contexte",id:"contexte",level:2},{value:"D\xe9cision",id:"d\xe9cision",level:2},{value:"1. Cr\xe9ation d&#39;une version",id:"1-cr\xe9ation-dune-version",level:3},{value:"2. Cr\xe9er la branche li\xe9e \xe0 la version",id:"2-cr\xe9er-la-branche-li\xe9e-\xe0-la-version",level:3},{value:"3. D\xe9ployer la branche versionn\xe9e",id:"3-d\xe9ployer-la-branche-versionn\xe9e",level:3},{value:"Cons\xe9quences",id:"cons\xe9quences",level:2}],c={toc:u},p="wrapper";function d(e){let{components:n,...t}=e;return(0,i.kt)(p,(0,r.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"mise-en-production"},"Mise en Production"),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"7 novembre 2022")),(0,i.kt)("h2",{id:"contributeurs"},"Contributeurs"),(0,i.kt)("p",null,"S\xe9bastien F."),(0,i.kt)("h2",{id:"statut"},"Statut"),(0,i.kt)("p",null,"Accept\xe9"),(0,i.kt)("h2",{id:"contexte"},"Contexte"),(0,i.kt)("p",null,"Lorsque nous devons faire un rollback d'une mise en production (MEP), nous souhaitons que cela se\nfasse \xe0 partir de la derni\xe8re version qui a \xe9t\xe9 mise en production."),(0,i.kt)("p",null,"Il a \xe9t\xe9 d\xe9cid\xe9 que les MEP soient effectu\xe9s une \xe0 deux fois par it\xe9ration."),(0,i.kt)("h2",{id:"d\xe9cision"},"D\xe9cision"),(0,i.kt)("p",null,"Pour pouvoir facilement revenir \xe0 la version pr\xe9c\xe9dente, il faudrait que nous ayons un historique pr\xe9cis des diff\xe9rentes\nversions qui sont parties en production."),(0,i.kt)("h3",{id:"1-cr\xe9ation-dune-version"},"1. Cr\xe9ation d'une version"),(0,i.kt)("p",null,"Nous utilisons actuellement ",(0,i.kt)("inlineCode",{parentName:"p"},"release-please")," afin de g\xe9n\xe9rer des versions et des notes de version."),(0,i.kt)("p",null,"Une version sera cr\xe9\xe9e \xe0 chaque fois qu'un commit poss\xe9dant les mots cl\xe9s ",(0,i.kt)("inlineCode",{parentName:"p"},"feat")," ou ",(0,i.kt)("inlineCode",{parentName:"p"},"fix")," sera merg\xe9 sur ",(0,i.kt)("inlineCode",{parentName:"p"},"main"),". Une\nversion sera \xe9galement cr\xe9\xe9e \xe0 chaque introduction d'un ",(0,i.kt)("inlineCode",{parentName:"p"},"breaking change"),"."),(0,i.kt)("p",null,"Par exemples :"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Breaking change : ",(0,i.kt)("inlineCode",{parentName:"li"},"chore!: modification drastique dans l'utilisation de l'application"),"."),(0,i.kt)("li",{parentName:"ul"},"Fonctionnalit\xe9 : ",(0,i.kt)("inlineCode",{parentName:"li"},"feat(stages): ajout d'une nouvelle fonctionnalit\xe9")),(0,i.kt)("li",{parentName:"ul"},"Correction de bug : ",(0,i.kt)("inlineCode",{parentName:"li"},"fix(stages): correction d'un bug"))),(0,i.kt)("p",null,"En suivant le principe de ",(0,i.kt)("inlineCode",{parentName:"p"},"semantic versionning"),", le premier exemple provoquera une mont\xe9e de version majeure : ",(0,i.kt)("inlineCode",{parentName:"p"},"1.0.0"),"\n-> ",(0,i.kt)("inlineCode",{parentName:"p"},"2.0.0"),", le second exemple provoquera une mont\xe9e de version mineure : ",(0,i.kt)("inlineCode",{parentName:"p"},"1.0.0")," -> ",(0,i.kt)("inlineCode",{parentName:"p"},"1.1.0")," et le dernier exemple\nprovoquera une mont\xe9e de version corrective : ",(0,i.kt)("inlineCode",{parentName:"p"},"1.0.0")," -> ",(0,i.kt)("inlineCode",{parentName:"p"},"1.0.1"),"."),(0,i.kt)("p",null,"Il est \xe9galement possible de forcer la cr\xe9ation d'une version en le pr\xe9cisant dans un commit vide."),(0,i.kt)("p",null,"Par exemple : ",(0,i.kt)("inlineCode",{parentName:"p"},'git commit --allow-empty -m "chore(some context): release 2.0.1" -m "Release-As: 2.0.1"'),"."),(0,i.kt)("p",null,"\u26a0\ufe0f ",(0,i.kt)("inlineCode",{parentName:"p"},"release-please")," va cr\xe9er une ",(0,i.kt)("inlineCode",{parentName:"p"},"Pull Request")," qu'il est imp\xe9ratif de merger pour cr\xe9er un ",(0,i.kt)("inlineCode",{parentName:"p"},"tag")," (au sens Git) et pour\ncr\xe9er les notes de version associ\xe9es."),(0,i.kt)("h3",{id:"2-cr\xe9er-la-branche-li\xe9e-\xe0-la-version"},"2. Cr\xe9er la branche li\xe9e \xe0 la version"),(0,i.kt)("p",null,"Scalingo ne nous permet pas actuellement d\xe9ployer un ",(0,i.kt)("inlineCode",{parentName:"p"},"tag"),". De ce fait, il vous faudra n\xe9cessairement cr\xe9er une branche\nde ",(0,i.kt)("inlineCode",{parentName:"p"},"release"),". La nomenclature \xe0 suivre serait id\xe9alement la suivante : ",(0,i.kt)("inlineCode",{parentName:"p"},"release/<num\xe9ro de version>"),"."),(0,i.kt)("p",null,"Par exemple :"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"release/2.8.3")),(0,i.kt)("h3",{id:"3-d\xe9ployer-la-branche-versionn\xe9e"},"3. D\xe9ployer la branche versionn\xe9e"),(0,i.kt)("p",null,"Deux options sont possibles :"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Par le client Web Scalingo et s\xe9lectionner la branche en question \xe0 d\xe9ployer ;"),(0,i.kt)("li",{parentName:"ol"},"Par le d\xe9p\xf4t ",(0,i.kt)("inlineCode",{parentName:"li"},"1j1s-infrastructure")," apr\xe8s modifi\xe9 la variable d'environnement de la branche \xe0 d\xe9ployer.")),(0,i.kt)("h2",{id:"cons\xe9quences"},"Cons\xe9quences"),(0,i.kt)("p",null,"Une mise \xe0 jour du code du d\xe9p\xf4t ",(0,i.kt)("inlineCode",{parentName:"p"},"1j1s-infrastructure")," est n\xe9cessaire."),(0,i.kt)("p",null,"Enfin, nous pourrons effectuer un rollback de l'application en toute s\xe9curit\xe9."))}d.isMDXComponent=!0}}]);