"use strict";(self.webpackChunk_1j1s_etl_docs=self.webpackChunk_1j1s_etl_docs||[]).push([[425],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>k});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=r.createContext({}),c=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=c(e.components);return r.createElement(s.Provider,{value:n},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,l=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),p=c(t),m=a,k=p["".concat(s,".").concat(m)]||p[m]||d[m]||l;return t?r.createElement(k,o(o({ref:n},u),{},{components:t})):r.createElement(k,o({ref:n},u))}));function k(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var l=t.length,o=new Array(l);o[0]=m;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i[p]="string"==typeof e?e:a,o[1]=i;for(var c=2;c<l;c++)o[c]=t[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},8963:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>l,metadata:()=>i,toc:()=>c});var r=t(7462),a=(t(7294),t(3905));const l={},o="Utiliser les Scheduled Tasks Scalingo",i={unversionedId:"scheduled-tasks",id:"scheduled-tasks",title:"Utiliser les Scheduled Tasks Scalingo",description:"D\xe9marrage",source:"@site/docs/scheduled-tasks.md",sourceDirName:".",slug:"/scheduled-tasks",permalink:"/1j1s-etl/docs/scheduled-tasks",draft:!1,editUrl:"https://github.com/DNUM-SocialGouv/1j1s-etl/tree/main/docs/docs/docs/scheduled-tasks.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Que faire si tout se passe mal apr\xe8s une mise en production ?",permalink:"/1j1s-etl/docs/maintenance/sos"}},s={},c=[{value:"D\xe9marrage",id:"d\xe9marrage",level:2},{value:"D\xe9clarer une Scheduled Task",id:"d\xe9clarer-une-scheduled-task",level:2},{value:"Pour finir",id:"pour-finir",level:2},{value:"Exemple de fichier <code>cron.json</code>",id:"exemple-de-fichier-cronjson",level:2}],u={toc:c},p="wrapper";function d(e){let{components:n,...l}=e;return(0,a.kt)(p,(0,r.Z)({},u,l,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"utiliser-les-scheduled-tasks-scalingo"},"Utiliser les Scheduled Tasks Scalingo"),(0,a.kt)("h2",{id:"d\xe9marrage"},"D\xe9marrage"),(0,a.kt)("p",null,"Pour que Scalingo puisse reconna\xeetre des Scheduled Tasks, il a besoin de trouver un fichier ",(0,a.kt)("inlineCode",{parentName:"p"},"cron.json")," \xe0 la racine du\nprojet \xe0 d\xe9ployer."),(0,a.kt)("p",null,"Exemple :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"my-app\n\u251c\u2500\u2500\u2500 build\n\u2502    \u251c\u2500\u2500 some-fichier.js\n\u2502    \u2514\u2500\u2500 ...\n\u251c\u2500\u2500\u2500 node_modules\n\u2502    \u251c\u2500\u2500 some-library\n\u2502    \u2502   \u2514\u2500\u2500 some-other-domain-service.ts\n\u2502    \u2514\u2500\u2500 ...\n\u251c\u2500\u2500\u2500 src\n\u2502    \u251c\u2500\u2500 some-fichier.js\n\u2502    \u2514\u2500\u2500 ...\n\u251c\u2500\u2500\u2500 test\n\u2502    \u251c\u2500\u2500 some-fichier.test.js\n\u2502    \u2514\u2500\u2500 ...\n\u251c\u2500\u2500\u2500 **cron.json**\n\u251c\u2500\u2500\u2500 package.json\n\u251c\u2500\u2500\u2500 package-lock.json\n\u2514\u2500\u2500\u2500 ...\n")),(0,a.kt)("h2",{id:"d\xe9clarer-une-scheduled-task"},"D\xe9clarer une Scheduled Task"),(0,a.kt)("p",null,"Dans le fichier ",(0,a.kt)("inlineCode",{parentName:"p"},"cron.json")," cr\xe9\xe9 pr\xe9c\xe9demment, ajouter le squelette suivant :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jobs": []\n}\n')),(0,a.kt)("p",null,"Un job est un objet JSON ayant la forme suivante :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "command": "* * * * * npm run ma:tache:programmee",\n  "size": "M"\n}\n')),(0,a.kt)("p",null,"Penchons-nous sur les attributs et leur contenu :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"command")," est l'attribut dans lequel vous allez renseigner deux informations :",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Le ",(0,a.kt)("inlineCode",{parentName:"li"},"cron time"),", \xe0 savoir la fr\xe9quence \xe0 laquelle vous souhaitez ex\xe9cuter le job"),(0,a.kt)("li",{parentName:"ul"},"La commande \xe0 lancer, exemple ",(0,a.kt)("inlineCode",{parentName:"li"},"node start.js"),". Il ne tient qu'\xe0 vous de d\xe9finir vos propres commandes"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"size")," est l'attribut permettant de sp\xe9cifier la taille du conteneur dans lequel votre job va tourner sur Scalingo.\nLes valeurs possibles sont les suivantes : ",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"S")," pour 256 MB ;"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"M")," pour 512 MB ;"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"L")," pour 1 GB ;"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"XL")," pour 2 GB ;"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"2XL")," pour 4 GB.")))),(0,a.kt)("p",null,"Utilisez par d\xe9faut la valeur ",(0,a.kt)("inlineCode",{parentName:"p"},"M")," et augmentez si besoin."),(0,a.kt)("h2",{id:"pour-finir"},"Pour finir"),(0,a.kt)("p",null,"D\xe9ployez votre nouvelle version de votre code sur Scalingo. Si le fichier ",(0,a.kt)("inlineCode",{parentName:"p"},"cron.json")," est correctement renseign\xe9, vous\nverrez appara\xeetre vos Scheduled Tasks dans l'onglet ",(0,a.kt)("inlineCode",{parentName:"p"},"Ressources")," sur le panneau ",(0,a.kt)("inlineCode",{parentName:"p"},"Scheduled Tasks")," comme ci-dessous :"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img.png",src:t(6867).Z,width:"1357",height:"793"})),(0,a.kt)("h2",{id:"exemple-de-fichier-cronjson"},"Exemple de fichier ",(0,a.kt)("inlineCode",{parentName:"h2"},"cron.json")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "jobs": [\n      {\n        "command": "30 7 * * * npm run cli:transformation -- -a transform -f jobteaser",\n        "size": "M"\n      }, \n      {\n        "command": "30 6 * * * npm run cli:transformation -- -a transform -f stagefr",\n        "size": "S"\n      } \n    ]\n}\n')))}d.isMDXComponent=!0},6867:(e,n,t)=>{t.d(n,{Z:()=>r});const r=t.p+"assets/images/scalingo-scheduled-task-647e07f4c474959ec028fd3eb8be02ee.png"}}]);