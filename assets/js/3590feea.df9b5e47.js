"use strict";(self.webpackChunk_1j1s_etl_docs=self.webpackChunk_1j1s_etl_docs||[]).push([[557],{9420:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>l,metadata:()=>c,toc:()=>t});var i=s(4848),r=s(8453);const l={sidebar_label:"Les Scheduled tasks, comment \xe7a marche ?",sidebar_position:5},o="Utiliser les Scheduled Tasks Scalingo",c={id:"tuto/scheduled-tasks",title:"Utiliser les Scheduled Tasks Scalingo",description:"20 Avril 2023 (mis \xe0 jour le 24 Juillet 2024)",source:"@site/docs/tuto/scheduled-tasks.md",sourceDirName:"tuto",slug:"/tuto/scheduled-tasks",permalink:"/1j1s-etl/docs/tuto/scheduled-tasks",draft:!1,unlisted:!1,editUrl:"https://github.com/DNUM-SocialGouv/1j1s-etl/tree/main/docs/docs/docs/tuto/scheduled-tasks.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_label:"Les Scheduled tasks, comment \xe7a marche ?",sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Que faire Lorsque le flux ne se mets plus \xe0 jour ?",permalink:"/1j1s-etl/docs/tuto/le_flux_ne_met_plus_a_jour"},next:{title:"Que faire si l'indexation des donn\xe9es reste bloqu\xe9e \xe0 10000 donn\xe9es ?",permalink:"/1j1s-etl/docs/tuto/copie-donnee-en-local"}},d={},t=[{value:"D\xe9marrage",id:"d\xe9marrage",level:2},{value:"D\xe9clarer une Scheduled Task",id:"d\xe9clarer-une-scheduled-task",level:2},{value:"Periode d&#39;inactivit\xe9 des instances Scalingo",id:"periode-dinactivit\xe9-des-instances-scalingo",level:3},{value:"Pour finir",id:"pour-finir",level:2},{value:"Exemple de fichier <code>cron.json</code>",id:"exemple-de-fichier-cronjson",level:2}];function a(e){const n={admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"utiliser-les-scheduled-tasks-scalingo",children:"Utiliser les Scheduled Tasks Scalingo"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"20 Avril 2023 (mis \xe0 jour le 24 Juillet 2024)"})}),"\n",(0,i.jsx)(n.admonition,{title:"Contexte",type:"info",children:(0,i.jsx)(n.p,{children:"Une scheduled task (ou t\xe2che planifi\xe9e) est une op\xe9ration programm\xe9e pour s'ex\xe9cuter automatiquement \xe0 des moments pr\xe9d\xe9finis ou selon des intervalles sp\xe9cifiques. Par exemple transf\xe9rer les donn\xe9es du CEJ vers vers un serveur externe."})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"1j1s-cron",src:s(4894).A+"",width:"1115",height:"656"})}),"\n",(0,i.jsx)(n.h2,{id:"d\xe9marrage",children:"D\xe9marrage"}),"\n",(0,i.jsxs)(n.p,{children:["Pour que Scalingo puisse reconna\xeetre des Scheduled Tasks, il a besoin de trouver un fichier ",(0,i.jsx)(n.code,{children:"cron.json"})," \xe0 la racine du\nprojet \xe0 d\xe9ployer."]}),"\n",(0,i.jsx)(n.p,{children:"Exemple :"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"my-app\n\u251c\u2500\u2500\u2500 build\n\u2502    \u251c\u2500\u2500 some-fichier.js\n\u2502    \u2514\u2500\u2500 ...\n\u251c\u2500\u2500\u2500 node_modules\n\u2502    \u251c\u2500\u2500 some-library\n\u2502    \u2502   \u2514\u2500\u2500 some-other-domain-service.ts\n\u2502    \u2514\u2500\u2500 ...\n\u251c\u2500\u2500\u2500 src\n\u2502    \u251c\u2500\u2500 some-fichier.js\n\u2502    \u2514\u2500\u2500 ...\n\u251c\u2500\u2500\u2500 test\n\u2502    \u251c\u2500\u2500 some-fichier.test.js\n\u2502    \u2514\u2500\u2500 ...\n\u251c\u2500\u2500\u2500 **cron.json**\n\u251c\u2500\u2500\u2500 package.json\n\u251c\u2500\u2500\u2500 package-lock.json\n\u2514\u2500\u2500\u2500 ...\n"})}),"\n",(0,i.jsx)(n.h2,{id:"d\xe9clarer-une-scheduled-task",children:"D\xe9clarer une Scheduled Task"}),"\n",(0,i.jsxs)(n.p,{children:["Dans le fichier ",(0,i.jsx)(n.code,{children:"cron.json"})," cr\xe9\xe9 pr\xe9c\xe9demment, ajouter le squelette suivant :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "jobs": []\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Un job est un objet JSON ayant la forme suivante :"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "command": "* * * * * npm run ma:tache:programmee",\n  "size": "M"\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Penchons-nous sur les attributs et leur contenu :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"command"})," est l'attribut dans lequel vous allez renseigner deux informations :","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Le ",(0,i.jsx)(n.code,{children:"cron time"}),", \xe0 savoir la fr\xe9quence \xe0 laquelle vous souhaitez ex\xe9cuter le job"]}),"\n",(0,i.jsxs)(n.li,{children:["La commande \xe0 lancer, exemple ",(0,i.jsx)(n.code,{children:"node start.js"}),". Il ne tient qu'\xe0 vous de d\xe9finir vos propres commandes"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"size"})," est l'attribut permettant de sp\xe9cifier la taille du conteneur dans lequel votre job va tourner sur Scalingo.\nLes valeurs possibles sont les suivantes :","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"S"})," pour 256 MB ;"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"M"})," pour 512 MB ;"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"L"})," pour 1 GB ;"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"XL"})," pour 2 GB ;"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"2XL"})," pour 4 GB."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Utilisez par d\xe9faut la valeur ",(0,i.jsx)(n.code,{children:"M"})," et augmentez si besoin."]}),"\n",(0,i.jsx)(n.h3,{id:"periode-dinactivit\xe9-des-instances-scalingo",children:"Periode d'inactivit\xe9 des instances Scalingo"}),"\n",(0,i.jsx)(n.p,{children:"Dans le but d'\xe9conomiser des ressources, certaines instances de tests sont d\xe9sactiv\xe9es pendant la nuit (ex: main-cms)."}),"\n",(0,i.jsxs)(n.p,{children:["Comme le fichier ",(0,i.jsx)(n.code,{children:"cron.json"})," ne d\xe9pend pas de l'environnement, il faut s'assurer de d\xe9clencher les jobs \xe0 un moment o\xf9 les instances n\xe9cessaires sont disponibles."]}),"\n",(0,i.jsx)(n.h2,{id:"pour-finir",children:"Pour finir"}),"\n",(0,i.jsxs)(n.p,{children:["D\xe9ployez votre nouvelle version de votre code sur Scalingo. Si le fichier ",(0,i.jsx)(n.code,{children:"cron.json"})," est correctement renseign\xe9, vous\nverrez appara\xeetre vos Scheduled Tasks dans l'onglet ",(0,i.jsx)(n.code,{children:"Ressources"})," sur le panneau ",(0,i.jsx)(n.code,{children:"Scheduled Tasks"})," comme ci-dessous :"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"img.png",src:s(8386).A+"",width:"1357",height:"793"})}),"\n",(0,i.jsxs)(n.h2,{id:"exemple-de-fichier-cronjson",children:["Exemple de fichier ",(0,i.jsx)(n.code,{children:"cron.json"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "jobs": [\n      {\n        "command": "30 7 * * * npm run cli:transformation -- -a transform -f jobteaser",\n        "size": "M"\n      }, \n      {\n        "command": "30 6 * * * npm run cli:transformation -- -a transform -f stagefr",\n        "size": "S"\n      } \n    ]\n}\n'})})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},4894:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1j1s-cron-0ef96f2f5eb3518ca28eefd27d0cf961.png"},8386:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/scalingo-scheduled-task-647e07f4c474959ec028fd3eb8be02ee.png"},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>c});var i=s(6540);const r={},l=i.createContext(r);function o(e){const n=i.useContext(l);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);