"use strict";(self.webpackChunk_1j1s_etl_docs=self.webpackChunk_1j1s_etl_docs||[]).push([[628],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>f});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),u=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(l.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,s=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),p=u(n),m=a,f=p["".concat(l,".").concat(m)]||p[m]||d[m]||s;return n?r.createElement(f,i(i({ref:t},c),{},{components:n})):r.createElement(f,i({ref:t},c))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var s=n.length,i=new Array(s);i[0]=m;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[p]="string"==typeof e?e:a,i[1]=o;for(var u=2;u<s;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},7832:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>u});var r=n(7462),a=(n(7294),n(3905));const s={},i="Migration vers NestJS",o={unversionedId:"adr/2023-02-15.migration-nestjs",id:"adr/2023-02-15.migration-nestjs",title:"Migration vers NestJS",description:"15 f\xe9vrier 2023",source:"@site/docs/adr/2023-02-15.migration-nestjs.md",sourceDirName:"adr",slug:"/adr/2023-02-15.migration-nestjs",permalink:"/1j1s-etl/docs/adr/2023-02-15.migration-nestjs",draft:!1,editUrl:"https://github.com/DNUM-SocialGouv/1j1s-etl/tree/main/docs/docs/docs/adr/2023-02-15.migration-nestjs.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Exception dans le linter",permalink:"/1j1s-etl/docs/adr/2023-02-08.exception-dans-le-linter"},next:{title:"\u2696\ufe0f Conventions",permalink:"/1j1s-etl/docs/category/\ufe0f-conventions"}},l={},u=[{value:"Contributeurs",id:"contributeurs",level:2},{value:"Statut",id:"statut",level:2},{value:"Contexte",id:"contexte",level:2},{value:"D\xe9cision",id:"d\xe9cision",level:2},{value:"Cons\xe9quences",id:"cons\xe9quences",level:2},{value:"<em>Autres pistes explor\xe9es</em>",id:"autres-pistes-explor\xe9es",level:2}],c={toc:u},p="wrapper";function d(e){let{components:t,...n}=e;return(0,a.kt)(p,(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"migration-vers-nestjs"},"Migration vers NestJS"),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"15 f\xe9vrier 2023")),(0,a.kt)("h2",{id:"contributeurs"},"Contributeurs"),(0,a.kt)("p",null,"S. Fran\xe7ois, H. Dumont "),(0,a.kt)("h2",{id:"statut"},"Statut"),(0,a.kt)("p",null,"Accept\xe9"),(0,a.kt)("h2",{id:"contexte"},"Contexte"),(0,a.kt)("p",null,"Dans un contexte o\xf9 nous avons eu pas mal d'\xe9cueil avec le plugin Meilisearch pour Strapi, nous avons souhait\xe9 faire\n\xe9voluer l'architecture du produit pour orchestrer nous-m\xeame l'indexation des documents pour le site 1jeune1solution.\nNous souhaiterions id\xe9alement exposer une API pour des t\xe2ches d'indexation ou de maintenance via l'ETL."),(0,a.kt)("p",null,"De plus, nous souhaiterions utiliser un framework standard et largement r\xe9pandu pour permettre une appropriation plus\nais\xe9e de la codebase \xe0 de nouveaux venus sur le projet."),(0,a.kt)("h2",{id:"d\xe9cision"},"D\xe9cision"),(0,a.kt)("p",null,"Cette migration vers NestJS nous permettra d'exposer facilement une API \xe0 l'avenir et maintiendra la coh\xe9rence de la\ncodebase de par la standardisation apport\xe9e par NestJS."),(0,a.kt)("h2",{id:"cons\xe9quences"},"Cons\xe9quences"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"L'arborescence des fichiers a largement revue \xe9t\xe9 revue. ")),(0,a.kt)("p",null,"Anciennement :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-markdown"},".\n\u251c\u2500\u2500\u2500 docs\n\u251c\u2500\u2500\u2500 hooks\n\u251c\u2500\u2500\u2500 src\n\u2502    \u251c\u2500\u2500 cli\n\u2502    \u251c\u2500\u2500 configuration\n\u2502    \u251c\u2500\u2500 evenements\n\u2502    \u251c\u2500\u2500 logements\n\u2502    \u2514\u2500\u2500 stages\n\u2514\u2500\u2500\u2500 test\n")),(0,a.kt)("p",null,"Et aujourd'hui :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-markdown"},".\n\u251c\u2500\u2500\u2500 apps\n\u2502    \u251c\u2500\u2500 cli\n\u2502    \u2502   \u251c\u2500\u2500 src\n\u2502    \u2502   \u2514\u2500\u2500 test  \n\u2502    \u251c\u2500\u2500 configuration\n\u2502    \u2502   \u251c\u2500\u2500 src\n\u2502    \u2502   \u2514\u2500\u2500 test\n\u2502    \u251c\u2500\u2500 evenements\n\u2502    \u2502   \u251c\u2500\u2500 src\n\u2502    \u2502   \u2514\u2500\u2500 test\n\u2502    \u251c\u2500\u2500 logements\n\u2502    \u2502   \u251c\u2500\u2500 src\n\u2502    \u2502   \u2514\u2500\u2500 test\n\u2502    \u2514\u2500\u2500 stages\n\u2502        \u251c\u2500\u2500 src\n\u2502        \u2514\u2500\u2500 test\n\u251c\u2500\u2500\u2500 docs\n\u2514\u2500\u2500\u2500 hooks\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"La mani\xe8re de builder les applications a \xe9t\xe9 modifi\xe9e :")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-diff"},'{\n  "scripts": {\n-    "build": "tsc tsconfig.prod.json && tsc-alias",\n+    "build": "nest build api && nest build cli"\n  }\n}\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"La mani\xe8re d'ajouter une commande \xe0 la CLI a \xe9t\xe9 modifi\xe9e\n(voir ",(0,a.kt)("a",{parentName:"p",href:"https://docs.nestjs.com/recipes/nest-commander"},"la documentation de NestJS"),") ;")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"La mani\xe8re de lancer une commande via la CLI a \xe9t\xe9 modifi\xe9e :"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-diff"},"-$ npm run cli -- -d [domain] -a [action] -f [flowName]\n+$ npm run cli -- [action] [flowName] \n")),(0,a.kt)("h2",{id:"autres-pistes-explor\xe9es"},(0,a.kt)("em",{parentName:"h2"},"Autres pistes explor\xe9es")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Mise en place d'une API via ExpressJS mais qui ne r\xe9solvait pas notre second probl\xe8me de standardisation et qui \xe9tait\ndavantage co\xfbteuse \xe0 long terme ;"),(0,a.kt)("li",{parentName:"ul"},"Mise en place d'une API via HapiJS avec les m\xeames inconv\xe9nients que ci-dessus.")))}d.isMDXComponent=!0}}]);