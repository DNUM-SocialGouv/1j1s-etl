"use strict";(self.webpackChunk_1j1s_etl_docs=self.webpackChunk_1j1s_etl_docs||[]).push([[2],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>v});var r=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var i=r.createContext({}),u=function(e){var n=r.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},p=function(e){var n=u(e.components);return r.createElement(i.Provider,{value:n},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,i=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),c=u(t),m=o,v=c["".concat(i,".").concat(m)]||c[m]||d[m]||a;return t?r.createElement(v,l(l({ref:n},p),{},{components:t})):r.createElement(v,l({ref:n},p))}));function v(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,l=new Array(a);l[0]=m;var s={};for(var i in n)hasOwnProperty.call(n,i)&&(s[i]=n[i]);s.originalType=e,s[c]="string"==typeof e?e:o,l[1]=s;for(var u=2;u<a;u++)l[u]=t[u];return r.createElement.apply(null,l)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},5104:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>l,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>u});var r=t(7462),o=(t(7294),t(3905));const a={sidebar_label:"Que faire si tout se passe mal apr\xe8s une mise en production ?",sidebar_position:0},l="Que faire si tout se passe mal apr\xe8s une mise en production ?",s={unversionedId:"tuto/sos",id:"tuto/sos",title:"Que faire si tout se passe mal apr\xe8s une mise en production ?",description:"20 Avril 2023",source:"@site/docs/tuto/sos.md",sourceDirName:"tuto",slug:"/tuto/sos",permalink:"/1j1s-etl/docs/tuto/sos",draft:!1,editUrl:"https://github.com/DNUM-SocialGouv/1j1s-etl/tree/main/docs/docs/docs/tuto/sos.md",tags:[],version:"current",sidebarPosition:0,frontMatter:{sidebar_label:"Que faire si tout se passe mal apr\xe8s une mise en production ?",sidebar_position:0},sidebar:"tutorialSidebar",previous:{title:"\ud83e\uddd1\u200d\ud83c\udf93 Tutoriels",permalink:"/1j1s-etl/docs/category/-tutoriels"},next:{title:"Comment Rollback la base de donn\xe9es ?",permalink:"/1j1s-etl/docs/tuto/rollback-database"}},i={},u=[{value:"Pense-b\xeate",id:"pense-b\xeate",level:2},{value:"Comment red\xe9ployer une ancienne version ?",id:"comment-red\xe9ployer-une-ancienne-version-",level:2},{value:"Identifier la pr\xe9c\xe9dente version d\xe9ploy\xe9e",id:"identifier-la-pr\xe9c\xe9dente-version-d\xe9ploy\xe9e",level:3},{value:"Cr\xe9er une branche de release pour Scalingo",id:"cr\xe9er-une-branche-de-release-pour-scalingo",level:3},{value:"Red\xe9ployer cette branche sur Scalingo",id:"red\xe9ployer-cette-branche-sur-scalingo",level:3},{value:"Rollback la base de donn\xe9es",id:"rollback-la-base-de-donn\xe9es",level:3}],p={toc:u},c="wrapper";function d(e){let{components:n,...a}=e;return(0,o.kt)(c,(0,r.Z)({},p,a,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"que-faire-si-tout-se-passe-mal-apr\xe8s-une-mise-en-production-"},"Que faire si tout se passe mal apr\xe8s une mise en production ?"),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"20 Avril 2023")),(0,o.kt)("p",null,"Si demain, vous \xeates amen\xe9s \xe0 faire une mise en production et que d'avance \xe7a devait mal se passer, pas de panique !\nCe ne sera qu'une nouvelle mise en production de rat\xe9e dans la longue et triste histoire des mises en production rat\xe9es."),(0,o.kt)("h2",{id:"pense-b\xeate"},"Pense-b\xeate"),(0,o.kt)("p",null,"Voici un arbre de d\xe9cision qui peut vous aider en cas de p\xe9pin en production :"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Decisionnal Tree",src:t(5160).Z,width:"5648",height:"5423"})),(0,o.kt)("h2",{id:"comment-red\xe9ployer-une-ancienne-version-"},"Comment red\xe9ployer une ancienne version ?"),(0,o.kt)("h3",{id:"identifier-la-pr\xe9c\xe9dente-version-d\xe9ploy\xe9e"},"Identifier la pr\xe9c\xe9dente version d\xe9ploy\xe9e"),(0,o.kt)("p",null,"Pour identifier la version actuelle d'une application en production, connectez-vous \xe0 l'application Scalingo que vous\nsouhaitez red\xe9ployer. Regardez ensuite dans l'historique des d\xe9ploiements. Vous pouvez acc\xe9der aux logs de ces derniers\net parmi ces logs, vous devriez voir le nom du projet d\xe9ploy\xe9 ainsi que sa version. Par exemple :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"> 1j1s-etl@4.1.1 prepare\n")),(0,o.kt)("p",null,"On reconna\xeet bien ici le pattern ",(0,o.kt)("inlineCode",{parentName:"p"},"projectName@version"),". Une fois le num\xe9ro de release identifi\xe9, il vous suffit de cr\xe9er\nune branche depuis laquelle red\xe9ployer sur Scalingo."),(0,o.kt)("h3",{id:"cr\xe9er-une-branche-de-release-pour-scalingo"},"Cr\xe9er une branche de release pour Scalingo"),(0,o.kt)("p",null,"L\xe0 encore, pas de panique ! C'est \xe0 \xe7a que nous sert ",(0,o.kt)("inlineCode",{parentName:"p"},"release-please")," dans la CI. Tout d'abord, sur votre poste, ouvrez\nun terminal et positionnez-vous dans le d\xe9p\xf4t que vous souhaitez rollback."),(0,o.kt)("p",null,"Dans un premier temps, r\xe9cup\xe9rer toutes les branches et tous les tags pr\xe9sents sur le d\xe9p\xf4t distant :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"$ git fetch --all --prune\n")),(0,o.kt)("p",null,"Le ",(0,o.kt)("inlineCode",{parentName:"p"},"--prune")," est du bonus pour nettoyer un petit peu votre d\xe9p\xf4t Git en local, vous n'\xeates pas oblig\xe9 de le faire."),(0,o.kt)("p",null,"Une fois fait, il vous suffit de lister les tags du d\xe9p\xf4t pour retrouver le num\xe9ro de version que vous souhaitez. Pour\nce faire :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"$ git tag | grep <votre num\xe9ro de version>\n")),(0,o.kt)("p",null,"Si le num\xe9ro de version se trouve bien dans la liste, vous devriez le voir en retour console. Par exemple :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"# Tag existant pour la version, grep vous renvoie la cha\xeene que vous avez recherch\xe9\n$ git tag | grep v4.0.0\nv4.0.0\n$\n\n# Tag inexistant pour la version, grep ne vous renvoie rien du tout\n$ git tag | grep v5.0.0\n$\n")),(0,o.kt)("p",null,"Si le tag existe, il va maintenant nous falloir cr\xe9er la branche depuis ce tag. Positionnez-vous tout d'abord sur le\ncommit du tag :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"$ git checkout <votre num\xe9ro de version>\n")),(0,o.kt)("p",null,"Exemple :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"$ git checkout v4.0.0\n")),(0,o.kt)("p",null,"Puis, il vous suffit de cr\xe9er la branche :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"$ git checkout -b release/<votre num\xe9ro de version>\n")),(0,o.kt)("h3",{id:"red\xe9ployer-cette-branche-sur-scalingo"},"Red\xe9ployer cette branche sur Scalingo"),(0,o.kt)("p",null,"Retournez maintenant sur Scalingo. Puis, dans l'onglet d\xe9ploiement, s\xe9lectionnez le d\xe9ploiement manuel qui vous permet\nde choisir la branche \xe0 d\xe9ployer. S\xe9lectionnez celle que vous venez de cr\xe9er puis d\xe9ployez-la."),(0,o.kt)("h3",{id:"rollback-la-base-de-donn\xe9es"},"Rollback la base de donn\xe9es"),(0,o.kt)("p",null,"Vous trouverez les \xe9tapes \xe0 suivre dans cette ",(0,o.kt)("a",{parentName:"p",href:"/1j1s-etl/docs/tuto/rollback-database"},"documentation"),"."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"And voil\xe0 !")))}d.isMDXComponent=!0},5160:(e,n,t)=>{t.d(n,{Z:()=>r});const r=t.p+"assets/images/decisional-tree-mep-2a07a48c5006f1f64c06d5194b4e9a5e.png"}}]);