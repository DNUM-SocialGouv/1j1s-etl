"use strict";(self.webpackChunk_1j1s_etl_docs=self.webpackChunk_1j1s_etl_docs||[]).push([[337],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>f});var n=r(7294);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var o=n.createContext({}),u=function(e){var t=n.useContext(o),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},c=function(e){var t=u(e.components);return n.createElement(o.Provider,{value:t},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,i=e.mdxType,a=e.originalType,o=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=u(r),m=i,f=d["".concat(o,".").concat(m)]||d[m]||p[m]||a;return r?n.createElement(f,s(s({ref:t},c),{},{components:r})):n.createElement(f,s({ref:t},c))}));function f(e,t){var r=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=r.length,s=new Array(a);s[0]=m;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l[d]="string"==typeof e?e:i,s[1]=l;for(var u=2;u<a;u++)s[u]=r[u];return n.createElement.apply(null,s)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},5948:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>o,contentTitle:()=>s,default:()=>p,frontMatter:()=>a,metadata:()=>l,toc:()=>u});var n=r(7462),i=(r(7294),r(3905));const a={},s="Enregistrement des fichiers",l={unversionedId:"adr/2022-08-01.enregistrement-des-fichiers",id:"adr/2022-08-01.enregistrement-des-fichiers",title:"Enregistrement des fichiers",description:"1er ao\xfbt 2022",source:"@site/docs/adr/2022-08-01.enregistrement-des-fichiers.md",sourceDirName:"adr",slug:"/adr/2022-08-01.enregistrement-des-fichiers",permalink:"/1j1s-etl/docs/adr/2022-08-01.enregistrement-des-fichiers",draft:!1,editUrl:"https://github.com/DNUM-SocialGouv/1j1s-etl/tree/main/docs/docs/docs/adr/2022-08-01.enregistrement-des-fichiers.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Historisation des flux extraits",permalink:"/1j1s-etl/docs/adr/2022-07-08.historisation-des-flux"},next:{title:"Utilisation des Scheduled Tasks",permalink:"/1j1s-etl/docs/adr/2022-08-03.scheduled-tasks"}},o={},u=[{value:"Contributeurs",id:"contributeurs",level:2},{value:"Statut",id:"statut",level:2},{value:"Contexte",id:"contexte",level:2},{value:"D\xe9cision",id:"d\xe9cision",level:2},{value:"Cons\xe9quences",id:"cons\xe9quences",level:2},{value:"Autres pistes explor\xe9es",id:"autres-pistes-explor\xe9es",level:2}],c={toc:u},d="wrapper";function p(e){let{components:t,...r}=e;return(0,i.kt)(d,(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"enregistrement-des-fichiers"},"Enregistrement des fichiers"),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"1er ao\xfbt 2022")),(0,i.kt)("h2",{id:"contributeurs"},"Contributeurs"),(0,i.kt)("p",null,"Simon B., S\xe9bastien F."),(0,i.kt)("h2",{id:"statut"},"Statut"),(0,i.kt)("p",null,"Accept\xe9"),(0,i.kt)("h2",{id:"contexte"},"Contexte"),(0,i.kt)("p",null,"Lors de l'\xe9criture des fichiers (historisation + derni\xe8re version), nous avons le choix entre \xe9crire s\xe9quentiellement\nles deux fichiers OU parall\xe9liser les \xe9critures."),(0,i.kt)("p",null,"Nous avons r\xe9alis\xe9 de brefs tests de performances sur des fichiers d'une taille avoisinant les 50 MiB avec les r\xe9sultats\nsuivants :"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Strat\xe9gie d'\xe9criture"),(0,i.kt)("th",{parentName:"tr",align:null},"Temps d'ex\xe9cution en secondes"),(0,i.kt)("th",{parentName:"tr",align:null},"Contexte"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"S\xe9quentielle"),(0,i.kt)("td",{parentName:"tr",align:null},"11,892s"),(0,i.kt)("td",{parentName:"tr",align:null},"Mac SEFR, MinIO qualification")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Parall\xe9lisation"),(0,i.kt)("td",{parentName:"tr",align:null},"8,768s"),(0,i.kt)("td",{parentName:"tr",align:null},"Mac SEFR, MinIO qualification")))),(0,i.kt)("h2",{id:"d\xe9cision"},"D\xe9cision"),(0,i.kt)("p",null,"\xc9criture s\xe9quentielle car la diff\xe9rence n'est pas assez significative. "),(0,i.kt)("h2",{id:"cons\xe9quences"},"Cons\xe9quences"),(0,i.kt)("p",null,"Positif : "),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Meilleure gestion d'erreur possible"),(0,i.kt)("li",{parentName:"ul"},"Pas de tentative d'\xe9criture du dernier fichier si l'historisation a \xe9chou\xe9"),(0,i.kt)("li",{parentName:"ul"},"Meilleure lisibilit\xe9 du code (pas de ",(0,i.kt)("inlineCode",{parentName:"li"},"Promise.all"),")")),(0,i.kt)("p",null,"N\xe9gatif :"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Temps d'ex\xe9cution plus important")),(0,i.kt)("h2",{id:"autres-pistes-explor\xe9es"},"Autres pistes explor\xe9es"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"return Promise.all([\n    this.sauvegarderFichierAHistoriser(contenuASauvegarder, configurationFlux),\n    this.sauvegarderCloneDuDernierFichier(contenuASauvegarder, configurationFlux),\n])\n")))}p.isMDXComponent=!0}}]);